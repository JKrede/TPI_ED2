MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;------------------------------------------------------------
                      00002 ; PROGRAMA: Medidor de CO - Trabajo Práctico Final Electrónica Digital 2
                      00003 ; ARCHIVO:  TPFinal.asm
                      00004 ; AUTORES:  Jerez, Facundo - Krede, Julián - Méndez Quiroga, Celeste Evangelina
                      00005 ; FECHA:    19/06/2025
                      00006 ; MICROCONTROLADOR: PIC16F887
                      00007 ; CLOCK: Oscilador XT (cristal externo) 4[MHz]
                      00008 ;
                      00009 ; DESCRIPCIÓN:
                      00010 ;   - Lee señal analógica de sensor de CO (canal AN7)
                      00011 ;   - Muestra valor en 4 displays de 7 segmentos:
                      00012 ;     * Modo normal: Muestra valor actual del ADC
                      00013 ;     * Modo teclado: Muestra umbral configurado
                      00014 ;   - Control mediante teclado matricial 4x3:
                      00015 ;     * Tecla '*' alterna entre modos de visualización
                      00016 ;     * Tecla '#' activa/desactiva alarma
                      00017 ;     * Teclas 0-9 configuran umbral de alarma
                      00018 ;   - Transmisión serial de valores (9600 baudios)
                      00019 ;   - Alarma visual/sonora cuando se supera umbral
                      00020 ;
                      00021 ; CONFIGURACIÓN:
                      00022 ;   - Oscilador XT
                      00023 ;   - WDT desactivado
                      00024 ;   - Master Clear habilitado
                      00025 ;   - Low Voltage Programming desactivado
                      00026 ;------------------------------------------------------------
                      00027                     
                      00028                     LIST P=16F887
                      00029                     #INCLUDE "P16F887.INC"
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ; Build date : Jul 23 2018
                      00005 ;  MPASM PIC16F887 processor include
                      00006 ; 
                      00007 ;  (c) Copyright 1999-2018 Microchip Technology, All rights reserved
                      00008 ;==========================================================================
                      00009 
                      00810         LIST
                      00030         
2007   2FF1           00031                     __CONFIG _CONFIG1, _XT_OSC & _WDTE_OFF & _MCLRE_ON & _LVP_OFF
                      00032         
                      00033 ;-------------------------
                      00034 ; VARIABLES DEL SISTEMA
                      00035 ;-------------------------
                      00036                     
                      00037 ; Variables en banco 0 (0x20-0x6F)
  00000020            00038 DELAY1DSPL    EQU   0x20    ; Contador delay para displays (primer nivel)
  00000021            00039 DELAY2DSPL    EQU   0x21    ; Contador delay para displays (segundo nivel)
  00000022            00040 DELAY3DSPL    EQU   0x22    ; Contador delay para displays (tercer nivel)
  00000023            00041 TEMP_VAL_ADC  EQU   0x23    ; Valor temporal del ADC para realizar la descomposicion
                      00042 
                      00043 ; Variables en banco común (0x70-0x7F)
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000070            00044 VAL_ADC       EQU   0x70    ; Valor crudo del ADC (0-255)
  00000071            00045 VAL_UMBRAL_U  EQU   0x71    ; Unidades del umbral (0-9)
  00000072            00046 VAL_UMBRAL_D  EQU   0x72    ; Decenas del umbral (0-9)
  00000073            00047 VAL_UMBRAL_C  EQU   0x73    ; Centenas del umbral (0-9)
  00000074            00048 POS_TECLA     EQU   0x74    ; Posición de tecla presionada (1-12)
  00000075            00049 N_TECLA       EQU   0x75    ; Contador de teclas presionadas (1-3)
  00000076            00050 TECLA_ACTIVA  EQU   0x76    ; Tecla actualmente presionada
  00000077            00051 OPCIONES      EQU   0x77    ; Registro de opciones:
                      00052                              ;   BIT 0: Modo display (0=ADC, 1=Teclado)
                      00053                              ;   BIT 1: Estado alarma (0=OFF, 1=ON)
  00000078            00054 DELAY1TMR0    EQU   0x78    ; Contador delay para ADC (primer nivel)
  00000079            00055 DELAY2TMR0    EQU   0x79    ; Contador delay para ADC (segundo nivel)
  0000007A            00056 W_TEMP        EQU   0x7A    ; Backup de W durante ISR
  0000007B            00057 STATUS_TEMP   EQU   0x7B    ; Backup de STATUS durante ISR
  0000007C            00058 VAL_ADC_U     EQU   0x7C    ; Unidades del valor ADC (0-9)
  0000007D            00059 VAL_ADC_D     EQU   0x7D    ; Decenas del valor ADC (0-9)
  0000007E            00060 VAL_ADC_C     EQU   0x7E    ; Centenas del valor ADC (0-9)
  0000007F            00061 VAL_ADC_M     EQU   0x7F    ; Unidades de mil del valor ADC
                      00062    
                      00063    
                      00064 ;-------------------------
                      00065 ; MACROS DE CONFIGURACIÓN
                      00066 ;-------------------------
                      00067 
                      00068 ;----------------------------------------------------------------
                      00069 ; CONFIGURACIÓN DEL TECLADO
                      00070 ;----------------------------------------------------------------
                      00071 ; CONFIG_TECLADO: Configura el puerto B para teclado matricial
                      00072 ;   - RB0-RB3 como salidas (filas)
                      00073 ;   - RB4-RB6 como entradas con pull-up (columnas)
                      00074 ;   - Habilita interrupciones por cambio en RB4-RB6
                      00075 CONF_TECLADO        MACRO
                      00076 
                      00077     BANKSEL         ANSELH
                      00078     CLRF            ANSELH          ; PUERTO B COMO DIGITAL
                      00079     MOVLW           B'01110000'  
                      00080     MOVWF           TRISB           ; <RB0-RB3> SALIDAS 
                      00081                                     ; <RB4-RB6> ENTRADAS
                      00082     BANKSEL         WPUB            
                      00083     BCF             OPTION_REG,7
                      00084     MOVLW           0XFF
                      00085     MOVWF           WPUB            ; RESISTENCIAS PULL-UPS ACTIVADAS
                      00086     BANKSEL         PORTB
                      00087     MOVLW           B'01110000'     
                      00088     MOVWF           PORTB           ;TODAS LAS ENTRADAS EN ALTO POR DEFECTO
                      00089 
                      00090     ENDM
                      00091 
                      00092 ;----------------------------------------------------------------
                      00093 ; CONFIGURACIÓN DE DISPLAYS 7 SEGMENTOS
                      00094 ;----------------------------------------------------------------
                      00095 ; Configura los puertos para controlar 4 displays de 7 segmentos:
                      00096 ;   - PORTD como salida (segmentos a-g)
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00097 ;   - RA0-RA3 como salidas (control de displays)
                      00098 ;   - Configura AN7 como entrada analógica para el sensor
                      00099 ;----------------------------------------------------------------
                      00100 CONF_DISPLAY        MACRO
                      00101     BANKSEL         ANSEL
                      00102     MOVLW           B'10000000'  ; AN7 como analógico, demás pines como digital
                      00103     MOVWF           ANSEL
                      00104 
                      00105     BANKSEL         TRISD
                      00106     CLRF            TRISD        ; PORTD completo como salida (segmentos)
                      00107 
                      00108     MOVLW           B'11110000'  ; RA0-RA3 como salidas (control displays)
                      00109     MOVWF           TRISA        ; RA4-RA7 como entradas (no usadas)
                      00110     ENDM
                      00111 
                      00112 ;----------------------------------------------------------------
                      00113 ; CONFIGURACIÓN DE SALIDA DE ALARMA
                      00114 ;----------------------------------------------------------------
                      00115 ; Configura RC0 como salida para controlar la alarma:
                      00116 ;   - Puede ser un LED, buzzer o relay
                      00117 ;   - Inicialmente apagada
                      00118 ;----------------------------------------------------------------
                      00119 CONF_ALARMA                 MACRO
                      00120     BANKSEL         TRISC
                      00121     BCF             TRISC, 0     ; RC0 como salida
                      00122 
                      00123     BANKSEL         PORTC
                      00124     BCF             PORTC, 0     ; Apaga la alarma inicialmente
                      00125 
                      00126     ENDM
                      00127 
                      00128 ;----------------------------------------------------------------
                      00129 ; CONFIGURACIÓN DEL MÓDULO ADC
                      00130 ;----------------------------------------------------------------
                      00131 ; Configura el ADC para leer el sensor de CO:
                      00132 ;   - Canal AN7 (RE2) como entrada analógica
                      00133 ;   - Voltaje de referencia interno (VDD y VSS)
                      00134 ;   - Justificación a la izquierda (8 bits MSB en ADRESH)
                      00135 ;   - Frecuencia de reloj Fosc/8
                      00136 ;   - Inicializa contadores de delay para primera lectura
                      00137 ;----------------------------------------------------------------
                      00138 CONF_ADC                    MACRO
                      00139     BANKSEL         TRISE
                      00140     BSF             TRISE, RE2   ; RE2 como entrada (AN7)
                      00141 
                      00142     BANKSEL         ADCON1
                      00143     CLRF            ADCON1       ; Voltaje referencia VDD/VSS, justificación izquierda
                      00144 
                      00145     BANKSEL         ADCON0
                      00146     MOVLW           B'01011101'  ; Fosc/8, canal AN7, ADC encendido
                      00147     MOVWF           ADCON0
                      00148 
                      00149     CLRF            DELAY1TMR0   ; Inicializa contadores para
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00150     CLRF            DELAY2TMR0   ; primera lectura del ADC
                      00151 
                      00152     ENDM
                      00153 
                      00154 ;----------------------------------------------------------------
                      00155 ; CONFIGURACIÓN DEL TIMER0
                      00156 ;----------------------------------------------------------------
                      00157 ; Configura Timer0 para generar interrupciones periódicas:
                      00158 ;   - Reloj interno (Fosc/4)
                      00159 ;   - Prescaler 1:256
                      00160 ;   - Valor inicial 61 para interrupciones cada ~50ms
                      00161 ;   (Considerando oscilador de 4MHz: 256*(256-61)*1?s ? 50ms)
                      00162 ;----------------------------------------------------------------
                      00163 CONF_TIMER0                  MACRO
                      00164     BANKSEL         OPTION_REG
                      00165     MOVLW           B'01010111'  ; Internal clock, prescaler 1:256 asignado a TMR0
                      00166     MOVWF           OPTION_REG
                      00167 
                      00168     BANKSEL         TMR0
                      00169     MOVLW           .61          ; Valor inicial para ~50ms (ajustar según Fosc)
                      00170     MOVWF           TMR0
                      00171 
                      00172     ENDM
                      00173 ;----------------------------------------------------------------
                      00174 ; CONFIGURACIÓN DE INTERRUPCIONES
                      00175 ;----------------------------------------------------------------
                      00176 ; Habilita las interrupciones globales y específicas:
                      00177 ;   - Interrupciones por cambio en PORTB (teclado)
                      00178 ;   - Interrupciones por desborde del Timer0
                      00179 ;   - Configura IOCB para interrupciones solo en RB4-RB6
                      00180 ;----------------------------------------------------------------
                      00181 CONF_INTERRUPCION           MACRO
                      00182     MOVLW           B'10101000'  ; Habilita: INTCON.GIE, INTCON.T0IE, INTCON.RBIE
                      00183     MOVWF           INTCON
                      00184 
                      00185     BANKSEL         IOCB
                      00186     MOVLW           B'01110000'  ; Habilita interrupciones solo en RB4-RB6
                      00187     MOVWF           IOCB
                      00188 
                      00189     ENDM
                      00190 
                      00191 ;----------------------------------------------------------------
                      00192 ; CONFIGURACIÓN DE COMUNICACIÓN SERIAL (UART)
                      00193 ;----------------------------------------------------------------
                      00194 ; Configura el módulo EUSART para transmisión serial:
                      00195 ;   - Baud rate 9600 (para 4MHz y BRGH=1)
                      00196 ;   - Solo transmisión (no recepción)
                      00197 ;   - 8 bits de datos, sin paridad
                      00198 ;----------------------------------------------------------------
                      00199 CONF_COMUNICACION           MACRO
                      00200     BANKSEL         TXSTA
                      00201     MOVLW           B'00100100'  ; BRGH=1 (alta velocidad), TXEN=1 (habilitar TX)
                      00202     MOVWF           TXSTA
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00203 
                      00204     MOVLW           .25          ; SPBRG = 25 para 9600 bauds (4MHz, BRGH=1)
                      00205     MOVWF           SPBRG
                      00206 
                      00207     BANKSEL         RCSTA
                      00208     MOVLW           B'10010000'  ; puerto serial habilitado, 8-bit recepcion
                      00209     MOVWF           RCSTA
                      00210 
                      00211     BANKSEL         BAUDCTL
                      00212     BCF             BAUDCTL, 3   ; BAUD Generator = 8 bits
                      00213 
                      00214     ENDM
                      00215         
                      00216 ;-------------------------
                      00217 ; Código principal
                      00218 ;-------------------------
                      00219                     ORG             0X00
0000   2???           00220                     GOTO            INICIO
                      00221                     
                      00222                     ORG             0X04
0004   2???           00223                     GOTO            ISR
                      00224                     
                      00225                     ORG             0X05
                      00226 
0005                  00227 INICIO              ;INICIO PROGRAMA
                      00228                     CONF_TECLADO
                          M 
0005   1683 1703          M     BANKSEL         ANSELH
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0007   0189               M     CLRF            ANSELH          ; PUERTO B COMO DIGITAL
0008   3070               M     MOVLW           B'01110000'  
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0009   0086               M     MOVWF           TRISB           ; <RB0-RB3> SALIDAS 
                          M                                     ; <RB4-RB6> ENTRADAS
000A   1683 1303          M     BANKSEL         WPUB            
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
000C   1381               M     BCF             OPTION_REG,7
000D   30FF               M     MOVLW           0XFF
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
000E   0095               M     MOVWF           WPUB            ; RESISTENCIAS PULL-UPS ACTIVADAS
000F   1283 1303          M     BANKSEL         PORTB
0011   3070               M     MOVLW           B'01110000'     
0012   0086               M     MOVWF           PORTB           ;TODAS LAS ENTRADAS EN ALTO POR DEFECTO
                          M 
                      00229                     CONF_DISPLAY
0013   1683 1703          M     BANKSEL         ANSEL
0015   3080               M     MOVLW           B'10000000'  ; AN7 como analógico, demás pines como digital
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0016   0088               M     MOVWF           ANSEL
                          M 
0017   1683 1303          M     BANKSEL         TRISD
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0019   0188               M     CLRF            TRISD        ; PORTD completo como salida (segmentos)
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M 
001A   30F0               M     MOVLW           B'11110000'  ; RA0-RA3 como salidas (control displays)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
001B   0085               M     MOVWF           TRISA        ; RA4-RA7 como entradas (no usadas)
                      00230                     CONF_ALARMA
001C   1683 1303          M     BANKSEL         TRISC
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
001E   1007               M     BCF             TRISC, 0     ; RC0 como salida
                          M 
001F   1283 1303          M     BANKSEL         PORTC
0021   1007               M     BCF             PORTC, 0     ; Apaga la alarma inicialmente
                          M 
                      00231                     CONF_ADC
0022   1683 1303          M     BANKSEL         TRISE
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0024   1509               M     BSF             TRISE, RE2   ; RE2 como entrada (AN7)
                          M 
0025   1683 1303          M     BANKSEL         ADCON1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0027   019F               M     CLRF            ADCON1       ; Voltaje referencia VDD/VSS, justificación izquierda
                          M 
0028   1283 1303          M     BANKSEL         ADCON0
002A   305D               M     MOVLW           B'01011101'  ; Fosc/8, canal AN7, ADC encendido
002B   009F               M     MOVWF           ADCON0
                          M 
002C   01F8               M     CLRF            DELAY1TMR0   ; Inicializa contadores para
002D   01F9               M     CLRF            DELAY2TMR0   ; primera lectura del ADC
                          M 
                      00232                     CONF_TIMER0
002E   1683 1303          M     BANKSEL         OPTION_REG
0030   3057               M     MOVLW           B'01010111'  ; Internal clock, prescaler 1:256 asignado a TMR0
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0031   0081               M     MOVWF           OPTION_REG
                          M 
0032   1283 1303          M     BANKSEL         TMR0
0034   303D               M     MOVLW           .61          ; Valor inicial para ~50ms (ajustar según Fosc)
0035   0081               M     MOVWF           TMR0
                          M 
                      00233                     CONF_COMUNICACION
0036   1683 1303          M     BANKSEL         TXSTA
0038   3024               M     MOVLW           B'00100100'  ; BRGH=1 (alta velocidad), TXEN=1 (habilitar TX)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0039   0098               M     MOVWF           TXSTA
                          M 
003A   3019               M     MOVLW           .25          ; SPBRG = 25 para 9600 bauds (4MHz, BRGH=1)
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
003B   0099               M     MOVWF           SPBRG
                          M 
003C   1283 1303          M     BANKSEL         RCSTA
003E   3090               M     MOVLW           B'10010000'  ; puerto serial habilitado, 8-bit recepcion
003F   0098               M     MOVWF           RCSTA
                          M 
0040   1683 1703          M     BANKSEL         BAUDCTL
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0042   1187               M     BCF             BAUDCTL, 3   ; BAUD Generator = 8 bits
                          M 
                      00234                     CONF_INTERRUPCION
0043   30A8               M     MOVLW           B'10101000'  ; Habilita: INTCON.GIE, INTCON.T0IE, INTCON.RBIE
0044   008B               M     MOVWF           INTCON
                          M 
0045   1683 1303          M     BANKSEL         IOCB
0047   3070               M     MOVLW           B'01110000'  ; Habilita interrupciones solo en RB4-RB6
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0048   0096               M     MOVWF           IOCB
                          M 
0049   01F7           00235                     CLRF            OPCIONES       ; Inicializar todas las opciones a 0
004A   3001           00236                     MOVLW           .1             ; Valor por defecto para umbral (100)
004B   00F3           00237                     MOVWF           VAL_UMBRAL_C
004C   3000           00238                     MOVLW           .0
004D   00F2           00239                     MOVWF           VAL_UMBRAL_D
004E   00F1           00240                     MOVWF           VAL_UMBRAL_U
                      00241                     
004F   1877           00242 REFRESH             BTFSC           OPCIONES, 0
0050   2???           00243                     CALL            MOSTRAR_TECLADO
0051   1C77           00244                     BTFSS           OPCIONES, 0
0052   2???           00245                     CALL            SHOW_ADC_DISPLAY
0053   18F7           00246                     BTFSC           OPCIONES, 1
0054   2???           00247                     CALL            CHECK_ALARMA
0055   2???           00248                     CALL            TEST_ALARMA
0056   2???           00249                     GOTO            REFRESH
                      00250                     
                      00251 ;--------------------------
                      00252 ; Subrutinas de la alarma
                      00253 ;--------------------------
                      00254 ;----------------------------------------------------------
                      00255 ; DESCOMP_VAL_ADC: Verifica que el valor del adc sea menor
                      00256 ;                  que el del valor umbral, y en base a eso
                      00257 ;                  edita el registro
                      00258 ;----------------------------------------------------------
0057                  00259 CHECK_ALARMA
0057   0873           00260                     MOVF            VAL_UMBRAL_C, W
0058   027E           00261                     SUBWF           VAL_ADC_C, W      ; VAL_ADC_C - VAL_UMBRAL_C
0059   1C03           00262                     BTFSS           STATUS, C         ; Si C=0 (VAL_ADC_C < VAL_UMBRAL_C)
005A   2???           00263                     GOTO            ACTIVAR_ALARMA    ; Centena ADC menor que umbral -> Activar
                      00264 
005B   1D03           00265                     BTFSS           STATUS, Z         ; Si Z=1 (VAL_ADC_C = VAL_UMBRAL_C)
005C   2???           00266                     GOTO            DESACTIVAR_ALARMA ; Centena ADC mayor que umbral -> Desactivar
                      00267 
                      00268                     ; Si centenas iguales, comparar DECENAS
005D   0872           00269                     MOVF            VAL_UMBRAL_D, W
005E   027D           00270                     SUBWF           VAL_ADC_D, W      ; VAL_ADC_D - VAL_UMBRAL_D
005F   1C03           00271                     BTFSS           STATUS, C         ; Si C=0 (VAL_ADC_D < VAL_UMBRAL_D)
0060   2???           00272                     GOTO            ACTIVAR_ALARMA    ; Decena ADC menor que umbral -> Activar
                      00273 
0061   1D03           00274                     BTFSS           STATUS, Z         ; Si Z=1 (VAL_ADC_D = VAL_UMBRAL_D)
0062   2???           00275                     GOTO            DESACTIVAR_ALARMA ; Decena ADC mayor que umbral -> Desactivar
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00276 
                      00277                     ; Si decenas iguales, comparar UNIDADES
0063   0871           00278                     MOVF            VAL_UMBRAL_U, W
0064   027C           00279                     SUBWF           VAL_ADC_U, W      ; VAL_ADC_U - VAL_UMBRAL_U
0065   1C03           00280                     BTFSS           STATUS, C         ; Si C=0 (VAL_ADC_U < VAL_UMBRAL_U)
0066   2???           00281                     GOTO            ACTIVAR_ALARMA    ; Unidad ADC menor que umbral -> Activar
                      00282 
                      00283                     ; Si llegamos aquí, VAL_ADC >= VAL_UMBRAL
0067   10F7           00284 DESACTIVAR_ALARMA   BCF             OPCIONES, 1       ; Limpiar bit de estado de alarma
0068   0008           00285                     RETURN
                      00286 
0069   14F7           00287 ACTIVAR_ALARMA      BSF             OPCIONES, 1       ; Setear bit de estado de alarma
006A   0008           00288                     RETURN
                      00289 
006B                  00290 TEST_ALARMA         
006B   1283 1303      00291                     BANKSEL         PORTC
006D   18F7           00292                     BTFSC           OPCIONES, 1
006E   1407           00293                     BSF             PORTC, 0
006F   1CF7           00294                     BTFSS           OPCIONES, 1
0070   1007           00295                     BCF             PORTC, 0
                      00296 
0071   0008           00297                     RETURN
                      00298                     
                      00299 ;-------------------------- 
                      00300 ; Subrutinas del display
                      00301 ;--------------------------
                      00302 ;----------------------------------------------------------
                      00303 ; DESCOMP_VAL_ADC: Descompone valor ADC (0-255) en dígitos
                      00304 ;   Entrada: VAL_ADC (valor a descomponer)
                      00305 ;   Salida:  VAL_ADC_U (unidades)
                      00306 ;            VAL_ADC_D (decenas)
                      00307 ;            VAL_ADC_C (centenas)
                      00308 ;            VAL_ADC_M (unidades de mil, siempre 0)
                      00309 ;   Altera:  W, STATUS
                      00310 ;----------------------------------------------------------
                      00311 
0072   1283           00312 DESCOMP_VAL_ADC     BCF             STATUS, RP0
0073   1303           00313                     BCF             STATUS, RP1     ;BANCO DE LOS VALORES DE ADC 
0074   0870           00314                     MOVF            VAL_ADC, W
0075   00A3           00315                     MOVWF           TEMP_VAL_ADC    ;GUARDA UNA COMPIA DE VAL_ADC
0076   01FC           00316                     CLRF            VAL_ADC_U       ;UNIDAD DEL VALOR A MOSTRAR
0077   01FD           00317                     CLRF            VAL_ADC_D       ;UNIDAD DE DECENA DEL VALOR A MOSTRAR
0078   01FE           00318                     CLRF            VAL_ADC_C       ;UNIDAD DE CENTENA DEL VALOR A MOSTRAR
0079   01FF           00319                     CLRF            VAL_ADC_M       ;NUNCA VALE DISTINTO DE CERO
                      00320                     
007A   3064           00321 TEST_C              MOVLW           .100            ;CALCULA LA CENTENA
007B   02A3           00322                     SUBWF           TEMP_VAL_ADC, F
007C   1803           00323                     BTFSC           STATUS, C
007D   2???           00324                     GOTO            ADD_C
007E   3064           00325                     MOVLW           .100            ;SI ES NEGATIVO RECUPERA EL VALOR ORIGINAL (SOLO SE 
                            DA CUANDO ES 0)          
007F   07A3           00326                     ADDWF           TEMP_VAL_ADC, F 
0080   2???           00327                     GOTO            TEST_D 
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00328                     
0081   300A           00329 TEST_D              MOVLW           .10             ;CALCULA LA DECENA
0082   02A3           00330                     SUBWF           TEMP_VAL_ADC, F
0083   1803           00331                     BTFSC           STATUS, C
0084   2???           00332                     GOTO            ADD_D
0085   300A           00333                     MOVLW           .10             ;SI ES NEGATIVO RECUPERA EL VALOR ORIGINAL (SOLO SE 
                            DA CUANDO ES 0)          
0086   07A3           00334                     ADDWF           TEMP_VAL_ADC, F 
0087   2???           00335                     GOTO            TEST_U
                      00336                     
0088   3001           00337 TEST_U              MOVLW           .1              ;CALCULA LA UNIDAD
0089   02A3           00338                     SUBWF           TEMP_VAL_ADC, F
008A   1803           00339                     BTFSC           STATUS, C
008B   2???           00340                     GOTO            ADD_U
008C   3001           00341                     MOVLW           .1              ;SI ES NEGATIVO RECUPERA EL VALOR ORIGINAL (SOLO SE 
                            DA CUANDO ES 0)          
008D   07A3           00342                     ADDWF           TEMP_VAL_ADC, F 
                      00343                     
008E   0008           00344                     RETURN      
                      00345 
008F   0AFE           00346 ADD_C               INCF            VAL_ADC_C, F
0090   2???           00347                     GOTO            TEST_C
                      00348 
0091   0AFD           00349 ADD_D               INCF            VAL_ADC_D, F
0092   2???           00350                     GOTO            TEST_D         
                      00351 
0093   0AFC           00352 ADD_U               INCF            VAL_ADC_U, F
0094   2???           00353                     GOTO            TEST_U
                      00354         
                      00355 ;------------------------------------------------
                      00356 ; SHOW_ADC_DISPLAY: Muestra valor ADC en displays
                      00357 ;   Usa: VAL_ADC_U, VAL_ADC_D, VAL_ADC_C
                      00358 ;   Requiere: TABLA_DSPL inicializada
                      00359 ;   Tiempo: ~20ms (4 displays * 5ms)
                      00360 ;------------------------------------------------
0095   2???           00361 SHOW_ADC_DISPLAY    CALL            DESCOMP_VAL_ADC
                      00362                     
0096   1283 1303      00363                     BANKSEL         PORTA           ;BANCO 0
0098   3001           00364                     MOVLW           B'00000001'
0099   0085           00365                     MOVWF           PORTA           ;ACTIVA DISPLAY 1 Y DESACTIVA LOS DEMAS
009A   087C           00366                     MOVF            VAL_ADC_U, W
009B   2???           00367                     CALL            TABLA_DSPL      
009C   0088           00368                     MOVWF           PORTD           ;CARGA EL VALOR DE LA UNIDAD EN EL DISPLAY CON SU CO
                            RRESPONDIENTE FORMATO
009D   2???           00369                     CALL            DELAY5ms
                      00370                     
009E   3002           00371                     MOVLW           B'00000010'
009F   0085           00372                     MOVWF           PORTA           ;ACTIVA DISPLAY 2 Y DESACTIVA LOS DEMAS
00A0   087D           00373                     MOVF            VAL_ADC_D, W
00A1   2???           00374                     CALL            TABLA_DSPL
00A2   0088           00375                     MOVWF           PORTD           ;CARGA EL VALOR DE LA DECENA EN EL DISPLAY CON SU CO
                            RRESPONDIENTE FORMATO
00A3   2???           00376                     CALL            DELAY5ms
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00377                     
00A4   3004           00378                     MOVLW           B'00000100'
00A5   0085           00379                     MOVWF           PORTA           ;ACTIVA DISPLAY 3 Y DESACTIVA LOS DEMAS
00A6   087E           00380                     MOVF            VAL_ADC_C, W
00A7   2???           00381                     CALL            TABLA_DSPL
00A8   0088           00382                     MOVWF           PORTD           ;CARGA EL VALOR DE LA CENTENA EN EL DISPLAY CON SU C
                            ORRESPONDIENTE FORMATO
00A9   2???           00383                     CALL            DELAY5ms
                      00384                     
00AA   3008           00385                     MOVLW           B'00001000'
00AB   0085           00386                     MOVWF           PORTA           ;ACTIVA DISPLAY 4 Y DESACTIVA LOS DEMAS
00AC   087F           00387                     MOVF            VAL_ADC_M, W
00AD   2???           00388                     CALL            TABLA_DSPL
00AE   0088           00389                     MOVWF           PORTD           ;CARGA EL VALOR DE LA UNIDAD DE MIL EN EL DISPLAY CO
                            N SU CORRESPONDIENTE FORMATO
00AF   2???           00390                     CALL            DELAY5ms
00B0   0008           00391                     RETURN
                      00392                     
                      00393                     ;DELAY DE 5ms USADO PARA MOSTRAR VALORES EN DISPLAY (SHOW_DISPLAY)
00B1   1283           00394 DELAY5ms            BCF             STATUS, RP0
00B2   1303           00395                     BCF             STATUS, RP1     ;BANCO 0
00B3   3005           00396                     MOVLW           .5              ;m=5
00B4   00A0           00397                     MOVWF           DELAY1DSPL
00B5   3005           00398 DELAY1              MOVLW           .5              ;n=5
00B6   00A1           00399                     MOVWF           DELAY2DSPL
00B7   3041           00400 DELAY2              MOVLW           .65             ;p=65
00B8   00A2           00401                     MOVWF           DELAY3DSPL
00B9   0BA2           00402 DELAY3              DECFSZ          DELAY3DSPL, F
00BA   2???           00403                     GOTO            DELAY3
00BB   0BA1           00404                     DECFSZ          DELAY2DSPL, F
00BC   2???           00405                     GOTO            DELAY2
00BD   0BA0           00406                     DECFSZ          DELAY1DSPL, F
00BE   2???           00407                     GOTO            DELAY1
00BF   0008           00408                     RETURN
                      00409                     
                      00410 
                      00411                     ;TABLA CON PARA ENCENDER LOS SEGMENTOS CORRESPONDIENTES A CATODO COMUN (LOGICA POSIT
                            IVA)
00C0   0782           00412 TABLA_DSPL          ADDWF           PCL, F
00C1   343F           00413                     RETLW           0X3F            ;0
00C2   3406           00414                     RETLW           0X06            ;1
00C3   345B           00415                     RETLW           0X5B            ;2
00C4   344F           00416                     RETLW           0X4F            ;3
00C5   3466           00417                     RETLW           0X66            ;4
00C6   346D           00418                     RETLW           0X6D            ;5
00C7   347D           00419                     RETLW           0X7D            ;6
00C8   3407           00420                     RETLW           0X07            ;7
00C9   347F           00421                     RETLW           0X7F            ;8
00CA   3467           00422                     RETLW           0X67            ;9   
                      00423 
                      00424                     
                      00425                     
                      00426                     
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00427                     
                      00428 ;------------------------------------
                      00429 ; Subrutinas de comunicacion serial
                      00430 ;------------------------------------
                      00431                     ;REALIZA EL ENVIO DEL VALOR OBTENIDO DEL ADC CODIFICADO EN CODIGO ASCII. ESTA FUNCIO
                            N DEBE SER LLAMADA UNICAMENTE EN GET_ADC
00CB   087E           00432 ENVIAR_INFO         MOVF            VAL_ADC_C, W
00CC   3E30           00433                     ADDLW           .48
00CD   2???           00434                     CALL            UART_TX         ;ENVIA CENTENA
00CE   087D           00435                     MOVF            VAL_ADC_D, W
                      00436                     
00CF   3E30           00437                     ADDLW           .48
00D0   2???           00438                     CALL            UART_TX         ;ENVIA DECENA
00D1   1283           00439                     BCF             STATUS, RP0
00D2   1303           00440                     BCF             STATUS, RP1
00D3   087C           00441                     MOVF            VAL_ADC_U, W
                      00442                     
00D4   3E30           00443                     ADDLW           .48
00D5   2???           00444                     CALL            UART_TX         ;ENVIA UNIDAD
00D6   300A           00445                     MOVLW           .10
00D7   2???           00446                     CALL            UART_TX         ;SALTO DE LINEA
00D8   300D           00447                     MOVLW           .13
00D9   2???           00448                     CALL            UART_TX         ;RETORNO DE CARRO
00DA   0008           00449                     RETURN
                      00450                     
                      00451                     
00DB                  00452 UART_TX             
00DB   1683 1303      00453                     BANKSEL         TXSTA
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00DD   1C98           00454                     BTFSS           TXSTA, TRMT     ;VERIFICA QUE EL TSR ESTE VACIO
00DE   2???           00455                     GOTO            UART_TX
00DF   1283 1303      00456                     BANKSEL         TXREG
00E1   0099           00457                     MOVWF           TXREG           ;LUEGO DE ESTO SE ENVIA SOLO... EN TEORIA
00E2   0008           00458                     RETURN
                      00459             
                      00460 ;-------------------------
                      00461 ; Subrutinas del teclado
                      00462 ;-------------------------
                      00463 ;LAYOUT TECLADO:
                      00464 ; 1  2  3
                      00465 ; 4  5  6
                      00466 ; 7  8  9
                      00467 ; *  0  #
                      00468 ;
                      00469 ;------------------------------------------------
                      00470 ; ISR_TECLADO: Maneja interrupciones del teclado
                      00471 ;   Detecta tecla presionada mediante barrido
                      00472 ;   Maneja teclas especiales (* y #)
                      00473 ;   Almacena valores numéricos para umbral
                      00474 ;   Lógica antirrebote incorporada
                      00475 ;------------------------------------------------
00E3   01F4           00476 ISR_TECLADO         CLRF            POS_TECLA
                      00477                     
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00E4   01F6           00478                     CLRF            TECLA_ACTIVA
                      00479                     
00E5   3003           00480                     MOVLW           .3              ;VERIFICA QUE N_TECLA NO SUPERE 3
00E6   0275           00481                     SUBWF           N_TECLA, W
00E7   1903           00482                     BTFSC           STATUS,Z
00E8   01F5           00483                     CLRF            N_TECLA
                      00484                     
00E9   1283 1303      00485                     BANKSEL         PORTB
00EB   30FE           00486                     MOVLW           B'11111110'
00EC   0086           00487                     MOVWF           PORTB
00ED   0000           00488                     NOP
00EE   2???           00489                     GOTO            TEST_COL
                      00490                     
                      00491         
00EF   0AF4           00492 TEST_COL            INCF            POS_TECLA, F
00F0   1E06           00493                     BTFSS           PORTB, RB4      ;TESTEA COLUMNA1
00F1   2???           00494                     GOTO            TECLA_PRES
                      00495                     
00F2   0AF4           00496                     INCF            POS_TECLA, F
00F3   1E86           00497                     BTFSS           PORTB, RB5      ;TESTEA COLUMNA2
00F4   2???           00498                     GOTO            TECLA_PRES
                      00499                     
00F5   0AF4           00500                     INCF            POS_TECLA, F
00F6   1F06           00501                     BTFSS           PORTB, RB6      ;TESTEA COLUMNA3
00F7   2???           00502                     GOTO            TECLA_PRES
00F8   2???           00503                     GOTO            CAMBIAR_FILA
                      00504 
00F9   300C           00505 CAMBIAR_FILA        MOVLW           .12
00FA   0274           00506                     SUBWF           POS_TECLA, W
00FB   1903           00507                     BTFSC           STATUS, Z
00FC   2???           00508                     GOTO            FIN_ISR_TECLADO ;FINALIZA 
00FD   1403           00509                     BSF             STATUS, C
00FE   0D86           00510                     RLF             PORTB, F        ;MUEVE EL CERO A LA IZQUIERDA
00FF   2???           00511                     GOTO            TEST_COL
                      00512                     
                      00513                     
0100   1E06           00514 TECLA_PRES          BTFSS           PORTB, RB4      ;----------
0101   2???           00515                     GOTO            TECLA_PRES      ;
0102   1E86           00516                     BTFSS           PORTB, RB5      ;ANTIREBOTE
0103   2???           00517                     GOTO            TECLA_PRES      ;ANTIREBOTE
0104   1F06           00518                     BTFSS           PORTB, RB6      ;
0105   2???           00519                     GOTO            TECLA_PRES      ;----------
                      00520                     
                      00521                     ; VERIFICA SI ES UNA TECLA ESPECIAL
0106   0874           00522                     MOVF            POS_TECLA, W
0107   00F6           00523                     MOVWF           TECLA_ACTIVA
                      00524                 
                      00525                     ; TECLA '*' (POSICION 10): CAMBIA DISPLAY
0108   300A           00526                     MOVLW           .10
0109   0276           00527                     SUBWF           TECLA_ACTIVA, W
010A   1903           00528                     BTFSC           STATUS, Z
010B   2???           00529                     GOTO            CAMBIAR_DSPL
                      00530                 
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00531                     ; TECLA '#' (POSICION 12): ACTIVA/DESACTIVA ALARMA
010C   300C           00532                     MOVLW           .12
010D   0276           00533                     SUBWF           TECLA_ACTIVA, W
010E   1903           00534                     BTFSC           STATUS, Z
010F   2???           00535                     GOTO            CAMBIAR_ALARMA
                      00536                 
                      00537                     ; SI NO ERA TECLA ESPECIAL ENTONCES SIGUE Y CARGA VALORES
0110   0AF5           00538                     INCF            N_TECLA, F
0111   3001           00539                     MOVLW           .1
0112   0275           00540                     SUBWF           N_TECLA,W
0113   1903           00541                     BTFSC           STATUS,Z
0114   2???           00542                     GOTO            CARGAR_UMBRAL_C
                      00543                     
0115   3002           00544                     MOVLW           .2
0116   0275           00545                     SUBWF           N_TECLA,W
0117   1903           00546                     BTFSC           STATUS,Z
0118   2???           00547                     GOTO            CARGAR_UMBRAL_D
                      00548                     
0119   3003           00549                     MOVLW           .3
011A   0275           00550                     SUBWF           N_TECLA,W
011B   1903           00551                     BTFSC           STATUS,Z
011C   2???           00552                     GOTO            CARGAR_UMBRAL_U
                      00553                           
011D   2???           00554                     GOTO            FIN_ISR_TECLADO
                      00555                     
                      00556                     
011E                  00557 CARGAR_UMBRAL_C    
011E   0874           00558                     MOVF            POS_TECLA, W
011F   2???           00559                     CALL            TABLA_TECLADO
0120   00F3           00560                     MOVWF           VAL_UMBRAL_C
0121   2???           00561                     GOTO            FIN_ISR_TECLADO
                      00562 
0122                  00563 CARGAR_UMBRAL_D    
0122   0874           00564                     MOVF            POS_TECLA, W
0123   2???           00565                     CALL            TABLA_TECLADO
0124   00F2           00566                     MOVWF           VAL_UMBRAL_D
0125   2???           00567                     GOTO            FIN_ISR_TECLADO
                      00568                     
0126                  00569 CARGAR_UMBRAL_U     
0126   0874           00570                     MOVF            POS_TECLA, W
0127   2???           00571                     CALL            TABLA_TECLADO
0128   00F1           00572                     MOVWF           VAL_UMBRAL_U
0129   2???           00573                     GOTO            FIN_ISR_TECLADO
                      00574 
                      00575 ;----------------------------------------------
                      00576 ; CAMBIAR_DSPL: Alterna modo de visualización
                      00577 ;   Alterna BIT 0 de OPCIONES:
                      00578 ;     0 = Muestra valores del ADC
                      00579 ;     1 = Muestra valores del teclado (umbral)
                      00580 ;----------------------------------------------
012A                  00581 CAMBIAR_DSPL        
012A   3001           00582                     MOVLW           B'00000001'
012B   06F7           00583                     XORWF           OPCIONES, F                    
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

012C   2???           00584                     GOTO            FIN_ISR_TECLADO
                      00585 
                      00586 ;-----------------------------------------
                      00587 ; CAMBIAR_ALARMA: Activa/desactiva alarma
                      00588 ;   Alterna BIT 1 de OPCIONES:
                      00589 ;     0 = Alarma desactivada
                      00590 ;     1 = Alarma activada
                      00591 ;   Control físico en RC0
                      00592 ;-----------------------------------------
012D                  00593 CAMBIAR_ALARMA      
012D   3002           00594                     MOVLW           B'00000010'     
012E   06F7           00595                     XORWF           OPCIONES, F    
012F   2???           00596                     GOTO            FIN_ISR_TECLADO
                      00597                                     
0130                  00598 FIN_ISR_TECLADO     
0130   100B           00599                     BCF             INTCON, RBIF
0131   0008           00600                     RETURN  
                      00601                     
                      00602                     
0132                  00603 TABLA_TECLADO       
0132   0782           00604                     ADDWF           PCL, F
0133   0000           00605                     NOP                             ;   NO DEBERIA LLEGAR A ESTA LINEA
0134   3401           00606                     RETLW           .1              ;1
0135   3402           00607                     RETLW           .2              ;2
0136   3403           00608                     RETLW           .3              ;3
0137   3404           00609                     RETLW           .4              ;4
0138   3405           00610                     RETLW           .5              ;5
0139   3406           00611                     RETLW           .6              ;6
013A   3407           00612                     RETLW           .7              ;7
013B   3408           00613                     RETLW           .8              ;8
013C   3409           00614                     RETLW           .9              ;9
013D   34FF           00615                     RETLW           0XFF            ;*  NO DEBERIA LLEGAR A ESTA LINEA
013E   3400           00616                     RETLW           .0              ;0
013F   34FE           00617                     RETLW           0XFE            ;#  NO DEBERIA LLEGAR A ESTA LINEA
                      00618                     
                      00619                     
                      00620                         
0140                  00621 MOSTRAR_TECLADO    
0140   1283 1303      00622                     BANKSEL         PORTA           
0142   3001           00623                     MOVLW           B'00000001'
0143   0085           00624                     MOVWF           PORTA           ;ACTIVA DISPLAY 1 Y DESACTIVA LOS DEMAS
0144   0871           00625                     MOVF            VAL_UMBRAL_U, W
0145   2???           00626                     CALL            TABLA_DSPL      
0146   0088           00627                     MOVWF           PORTD           ;CARGA EL VALOR DE LA UNIDAD EN EL DISPLAY CON SU CO
                            RRESPONDIENTE FORMATO
0147   2???           00628                     CALL            DELAY5ms        
                      00629                     
0148   3002           00630                     MOVLW           B'00000010'
0149   0085           00631                     MOVWF           PORTA           ;ACTIVA DISPLAY 2 Y DESACTIVA LOS DEMAS
014A   0872           00632                     MOVF            VAL_UMBRAL_D, W
014B   2???           00633                     CALL            TABLA_DSPL
014C   0088           00634                     MOVWF           PORTD           ;CARGA EL VALOR DE LA DECENA EN EL DISPLAY CON SU CO
                            RRESPONDIENTE FORMATO
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

014D   2???           00635                     CALL            DELAY5ms
                      00636 
014E   3004           00637                     MOVLW           B'00000100'
014F   0085           00638                     MOVWF           PORTA           ;ACTIVA DISPLAY 3 Y DESACTIVA LOS DEMAS
0150   0873           00639                     MOVF            VAL_UMBRAL_C, W
0151   2???           00640                     CALL            TABLA_DSPL
0152   0088           00641                     MOVWF           PORTD           ;CARGA EL VALOR DE LA CENTENA EN EL DISPLAY CON SU C
                            ORRESPONDIENTE FORMATO
0153   2???           00642                     CALL            DELAY5ms
                      00643                     
0154   3008           00644                     MOVLW           B'00001000'
0155   0085           00645                     MOVWF           PORTA           ;ACTIVA DISPLAY 4 Y DESACTIVA LOS DEMAS
0156   3000           00646                     MOVLW           .0
0157   2???           00647                     CALL            TABLA_DSPL
0158   0088           00648                     MOVWF           PORTD           
0159   2???           00649                     CALL            DELAY5ms
                      00650                     
015A   0008           00651                     RETURN
                      00652                  
                      00653                     
                      00654 ;-------------------------
                      00655 ; Subrutinas del ADC
                      00656 ;-------------------------          
                      00657                     ;REALIZA LA CONVERSION DE LA SEÑAL ANALOGICA A DIGITAL Y GUARDA EL VALOR EN UNA VARI
                            ABLE TEMPORAL VAL_ADC
015B                  00658 READ_ADC            
015B   1283 1303      00659                     BANKSEL         ADCON0
015D   149F           00660                     BSF             ADCON0, 1       ;INICIALIZA LA CONVERSION
015E   189F           00661 WAIT_ADC            BTFSC           ADCON0, 1
015F   2???           00662                     GOTO            WAIT_ADC        ;ESPERA A LA FINALIZACION DE LA CONVERSION
0160   081E           00663                     MOVF            ADRESH, W
0161   00F0           00664                     MOVWF           VAL_ADC         ;MUEVO EL VALOR OBTENIDO POR EL ADC ALMACENADO EN VA
                            L_ADC
0162   2???           00665                     CALL            DESCOMP_VAL_ADC ;DESCOMPONE EL VALOR DEL VAL_ADC EN CENTENA, DECENA 
                            Y UNIDAD
0163   2???           00666                     CALL            ENVIAR_INFO     ;ENVIA EL DATO OBTENIDO DEL ADC MEDIANTE TRANSMISION
                             SERIE
                      00667                     
                      00668                     ;RECARGA LOS VALORES PARA DELAY_ADC
0164   30FF           00669                     MOVLW           .255
0165   00F8           00670                     MOVWF           DELAY1TMR0
0166   3005           00671                     MOVLW           .5
0167   00F9           00672                     MOVWF           DELAY2TMR0
                      00673                     
0168   0008           00674                     RETURN
                      00675                     
                      00676             
                      00677                     ;JUNTO CON EL TMR0, REALIZA UN DELAY DE 255*5*50ms = 63.75s
0169                  00678 ISR_ADC             
0169   1283 1303      00679                     BANKSEL         ADCON0
016B   303D           00680                     MOVLW           .61
016C   0081           00681                     MOVWF           TMR0            ;RECARGO EL TMR0 CON 61
016D   0BF8           00682                     DECFSZ          DELAY1TMR0, F
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

016E   2???           00683                     GOTO            FIN_ISR_ADC     
016F   2???           00684                     GOTO            TEST_DELAY2     ;SI DELAY1TMR0 LLEGO A 0 VA A CHECKEA DELAY2TMR0 
                      00685 
0170                  00686 FIN_ISR_ADC        
0170   110B           00687                     BCF             INTCON, T0IF    ;LIMPIA LA BANDERA
0171   0008           00688                     RETURN  
                      00689                     
                      00690                     ;SUBRUTINAS COMPLEMENTARIAS DE ISR_ADC
0172                  00691 TEST_DELAY2         
0172   0BF9           00692                     DECFSZ          DELAY2TMR0, F
0173   2???           00693                     GOTO            RECARGA_D1TMR0  ;SI DELAY2TMR0 NO LLEGO A 0 RECARGA DELAY1TMR0 Y SE 
                            VA A FIN_ISR_ADC
0174   2???           00694                     CALL            READ_ADC        ;SI DELAY1TMR0 LLEGO A 0 VA A LA SUBRUTINA QUE HACE 
                            LA CONVERSION, RECARGA DELAY1TMR0 Y DELAY2TMR0 
0175   2???           00695                     GOTO            FIN_ISR_ADC     ;LUEGO DE HACER LA CONVERSION SE VA A FIN_ISR_ADC
                      00696 
0176                  00697 RECARGA_D1TMR0      
0176   30FF           00698                     MOVLW           .255
0177   00F8           00699                     MOVWF           DELAY1TMR0
0178   2???           00700                     GOTO            FIN_ISR_ADC
                      00701                     
                      00702                     
                      00703 
                      00704 ;-------------------------
                      00705 ; Servicio de interrupcion
                      00706 ;-------------------------
                      00707                     ;SALVADO DE CONTEXTO
0179                  00708 ISR                 
0179   00FA           00709                     MOVWF           W_TEMP
017A   0E03           00710                     SWAPF           STATUS, W
017B   00FB           00711                     MOVWF           STATUS_TEMP
                      00712                     ;FIN DE SALVADO DE CONTEXTO
                      00713                     ;INICIO ISR                 FUENTES DE INTERRUPCION: PUERTO B(TECLADO), TIMER0(ADC)
017C   180B           00714                     BTFSC           INTCON, RBIF
017D   2???           00715                     CALL            ISR_TECLADO
017E   190B           00716                     BTFSC           INTCON, T0IF
017F   2???           00717                     CALL            ISR_ADC
                      00718                     ;RECUPERACION DE CONTEXTO
0180   0E7B           00719                     SWAPF           STATUS_TEMP, W
0181   0083           00720                     MOVWF           STATUS
0182   0EFA           00721                     SWAPF           W_TEMP, F
0183   0EFA           00722                     SWAPF           W_TEMP, F
                      00723                     ;FIN DE RECUPERACION DE CONTEXTO
0184   0009           00724                     RETFIE
                      00725                     
                      00726                     
2FF1                  00727                     END
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 17


SYMBOL TABLE
  LABEL                             VALUE 

ABDEN                             00000000
ABDOVF                            00000007
ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ACTIVAR_ALARMA                    00000069
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADDEN                             00000003
ADD_C                             0000008F
ADD_D                             00000091
ADD_U                             00000093
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
ANS0                              00000000
ANS1                              00000001
ANS10                             00000002
ANS11                             00000003
ANS12                             00000004
ANS13                             00000005
ANS2                              00000002
ANS3                              00000003
ANS4                              00000004
ANS5                              00000005
ANS6                              00000006
ANS7                              00000007
ANS8                              00000000
ANS9                              00000001
ANSEL                             00000188
ANSELH                            00000189
BAUDCTL                           00000187
BCLIE                             00000003
BCLIF                             00000003
BF                                00000000
BRG0                              00000000
BRG1                              00000001
BRG10                             00000002
BRG11                             00000003
BRG12                             00000004
BRG13                             00000005
BRG14                             00000006
BRG15                             00000007
BRG16                             00000003
BRG2                              00000002
BRG3                              00000003
BRG4                              00000004
BRG5                              00000005
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 18


SYMBOL TABLE
  LABEL                             VALUE 

BRG6                              00000006
BRG7                              00000007
BRG8                              00000000
BRG9                              00000001
BRGH                              00000002
C                                 00000000
C1CH0                             00000000
C1CH1                             00000001
C1IE                              00000005
C1IF                              00000005
C1OE                              00000005
C1ON                              00000007
C1OUT                             00000006
C1POL                             00000004
C1R                               00000002
C1RSEL                            00000005
C1SEN                             00000005
C2CH0                             00000000
C2CH1                             00000001
C2IE                              00000006
C2IF                              00000006
C2OE                              00000005
C2ON                              00000007
C2OUT                             00000006
C2POL                             00000004
C2R                               00000002
C2REN                             00000004
C2RSEL                            00000004
C2SYNC                            00000000
CAMBIAR_ALARMA                    0000012D
CAMBIAR_DSPL                      0000012A
CAMBIAR_FILA                      000000F9
CARGAR_UMBRAL_C                   0000011E
CARGAR_UMBRAL_D                   00000122
CARGAR_UMBRAL_U                   00000126
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 19


SYMBOL TABLE
  LABEL                             VALUE 

CCPR1                             00000015
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2                             0000001B
CCPR2H                            0000001C
CCPR2L                            0000001B
CHECK_ALARMA                      00000057
CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CHS3                              00000005
CKE                               00000006
CKP                               00000004
CM1CON0                           00000107
CM2CON0                           00000108
CM2CON1                           00000109
CONF_ADC                          
CONF_ALARMA                       
CONF_COMUNICACION                 
CONF_DISPLAY                      
CONF_INTERRUPCION                 
CONF_TECLADO                      
CONF_TIMER0                       
CREN                              00000004
CSRC                              00000007
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
DC1B0                             00000004
DC1B1                             00000005
DC2B0                             00000004
DC2B1                             00000005
DELAY1                            000000B5
DELAY1DSPL                        00000020
DELAY1TMR0                        00000078
DELAY2                            000000B7
DELAY2DSPL                        00000021
DELAY2TMR0                        00000079
DELAY3                            000000B9
DELAY3DSPL                        00000022
DELAY5ms                          000000B1
DESACTIVAR_ALARMA                 00000067
DESCOMP_VAL_ADC                   00000072
D_A                               00000005
D_NOT_A                           00000005
ECCPAS                            0000009C
ECCPAS0                           00000004
ECCPAS1                           00000005
ECCPAS2                           00000006
ECCPASE                           00000007
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 20


SYMBOL TABLE
  LABEL                             VALUE 

EECON2                            0000018D
EEDAT                             0000010C
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
ENVIAR_INFO                       000000CB
F                                 00000001
FERR                              00000002
FIN_ISR_ADC                       00000170
FIN_ISR_TECLADO                   00000130
FSR                               00000004
FVREN                             00000000
GCEN                              00000007
GIE                               00000007
GO                                00000001
GO_DONE                           00000001
GO_NOT_DONE                       00000001
HTS                               00000002
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
INDF                              00000000
INICIO                            00000005
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IOCB                              00000096
IOCB0                             00000000
IOCB1                             00000001
IOCB2                             00000002
IOCB3                             00000003
IOCB4                             00000004
IOCB5                             00000005
IOCB6                             00000006
IOCB7                             00000007
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRP                               00000007
ISR                               00000179
ISR_ADC                           00000169
ISR_TECLADO                       000000E3
LTS                               00000001
MC1OUT                            00000007
MC2OUT                            00000006
MOSTRAR_TECLADO                   00000140
MSK                               00000093
MSK0                              00000000
MSK1                              00000001
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 21


SYMBOL TABLE
  LABEL                             VALUE 

MSK2                              00000002
MSK3                              00000003
MSK4                              00000004
MSK5                              00000005
MSK6                              00000006
MSK7                              00000007
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000001
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
N_TECLA                           00000075
OERR                              00000001
OPCIONES                          00000077
OPTION_REG                        00000081
OSCCON                            0000008F
OSCTUNE                           00000090
OSFIE                             00000007
OSFIF                             00000007
OSTS                              00000003
P                                 00000004
P1M0                              00000006
P1M1                              00000007
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PDC0                              00000000
PDC1                              00000001
PDC2                              00000002
PDC3                              00000003
PDC4                              00000004
PDC5                              00000005
PDC6                              00000006
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PORTD                             00000008
PORTE                             00000009
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 22


SYMBOL TABLE
  LABEL                             VALUE 

POS_TECLA                         00000074
PR2                               00000092
PRSEN                             00000007
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSSAC0                            00000002
PSSAC1                            00000003
PSSBD0                            00000000
PSSBD1                            00000001
PSTRCON                           0000009D
PULSR                             00000002
PULSS                             00000003
PWM1CON                           0000009B
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RA6                               00000006
RA7                               00000007
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
RC6                               00000006
RC7                               00000007
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIDL                             00000006
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RD0                               00000000
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 23


SYMBOL TABLE
  LABEL                             VALUE 

RD1                               00000001
RD2                               00000002
RD3                               00000003
RD4                               00000004
RD5                               00000005
RD6                               00000006
RD7                               00000007
RE0                               00000000
RE1                               00000001
RE2                               00000002
RE3                               00000003
READ_ADC                          0000015B
READ_WRITE                        00000002
RECARGA_D1TMR0                    00000176
REFRESH                           0000004F
RP0                               00000005
RP1                               00000006
RSEN                              00000001
RX9                               00000006
RX9D                              00000000
R_NOT_W                           00000002
R_W                               00000002
S                                 00000003
SBOREN                            00000004
SCKP                              00000004
SCS                               00000000
SEN                               00000000
SENDB                             00000003
SHOW_ADC_DISPLAY                  00000095
SMP                               00000007
SPBRG                             00000099
SPBRGH                            0000009A
SPEN                              00000007
SR0                               00000006
SR1                               00000007
SRCON                             00000185
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPMSK                            00000093
SSPOV                             00000006
SSPSTAT                           00000094
STATUS                            00000003
STATUS_TEMP                       0000007B
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 24


SYMBOL TABLE
  LABEL                             VALUE 

STRA                              00000000
STRB                              00000001
STRC                              00000002
STRD                              00000003
STRSYNC                           00000004
SWDTEN                            00000000
SYNC                              00000004
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1GINV                            00000007
T1GIV                             00000007
T1GSS                             00000001
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TABLA_DSPL                        000000C0
TABLA_TECLADO                     00000132
TECLA_ACTIVA                      00000076
TECLA_PRES                        00000100
TEMP_VAL_ADC                      00000023
TEST_ALARMA                       0000006B
TEST_C                            0000007A
TEST_COL                          000000EF
TEST_D                            00000081
TEST_DELAY2                       00000172
TEST_U                            00000088
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1                              0000000E
TMR1CS                            00000001
TMR1GE                            00000006
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 25


SYMBOL TABLE
  LABEL                             VALUE 

TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISA6                            00000006
TRISA7                            00000007
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRISC                             00000087
TRISC0                            00000000
TRISC1                            00000001
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TRISC6                            00000006
TRISC7                            00000007
TRISD                             00000088
TRISD0                            00000000
TRISD1                            00000001
TRISD2                            00000002
TRISD3                            00000003
TRISD4                            00000004
TRISD5                            00000005
TRISD6                            00000006
TRISD7                            00000007
TRISE                             00000089
TRISE0                            00000000
TRISE1                            00000001
TRISE2                            00000002
TRISE3                            00000003
TRMT                              00000001
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 26


SYMBOL TABLE
  LABEL                             VALUE 

TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
UA                                00000001
UART_TX                           000000DB
ULPWUE                            00000005
ULPWUIE                           00000002
ULPWUIF                           00000002
VAL_ADC                           00000070
VAL_ADC_C                         0000007E
VAL_ADC_D                         0000007D
VAL_ADC_M                         0000007F
VAL_ADC_U                         0000007C
VAL_UMBRAL_C                      00000073
VAL_UMBRAL_D                      00000072
VAL_UMBRAL_U                      00000071
VCFG0                             00000004
VCFG1                             00000005
VR0                               00000000
VR1                               00000001
VR2                               00000002
VR3                               00000003
VRCON                             00000097
VREN                              00000007
VROE                              00000006
VRR                               00000005
VRSS                              00000004
W                                 00000000
WAIT_ADC                          0000015E
WCOL                              00000007
WDTCON                            00000105
WDTPS0                            00000001
WDTPS1                            00000002
WDTPS2                            00000003
WDTPS3                            00000004
WPUB                              00000095
WPUB0                             00000000
WPUB1                             00000001
WPUB2                             00000002
WPUB3                             00000003
WPUB4                             00000004
WPUB5                             00000005
WPUB6                             00000006
WPUB7                             00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
WUE                               00000001
W_TEMP                            0000007A
Z                                 00000002
_BOR21V                           00003EFF
_BOR40V                           00003FFF
_BOR4V_BOR21V                     00003EFF
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 27


SYMBOL TABLE
  LABEL                             VALUE 

_BOR4V_BOR40V                     00003FFF
_BOREN_NSLEEP                     00003EFF
_BOREN_OFF                        00003CFF
_BOREN_ON                         00003FFF
_BOREN_SBODEN                     00003DFF
_BOR_NSLEEP                       00003EFF
_BOR_OFF                          00003CFF
_BOR_ON                           00003FFF
_BOR_SBODEN                       00003DFF
_CONFIG1                          00002007
_CONFIG2                          00002008
_CPD_OFF                          00003FFF
_CPD_ON                           00003F7F
_CP_OFF                           00003FFF
_CP_ON                            00003FBF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         00001FFF
_DEVID1                           00002006
_EC_OSC                           00003FFB
_EXTRC                            00003FFF
_EXTRCIO                          00003FFE
_EXTRC_OSC_CLKOUT                 00003FFF
_EXTRC_OSC_NOCLKOUT               00003FFE
_FCMEN_OFF                        000037FF
_FCMEN_ON                         00003FFF
_FOSC_EC                          00003FFB
_FOSC_EXTRC_CLKOUT                00003FFF
_FOSC_EXTRC_NOCLKOUT              00003FFE
_FOSC_HS                          00003FFA
_FOSC_INTRC_CLKOUT                00003FFD
_FOSC_INTRC_NOCLKOUT              00003FFC
_FOSC_LP                          00003FF8
_FOSC_XT                          00003FF9
_HS_OSC                           00003FFA
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_IESO_OFF                         00003BFF
_IESO_ON                          00003FFF
_INTOSC                           00003FFD
_INTOSCIO                         00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LP_OSC                           00003FF8
_LVP_OFF                          00002FFF
_LVP_ON                           00003FFF
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FEF
_WDTE_OFF                         00003FF7
_WDTE_ON                          00003FFF
MPASM 5.81                       TPFINAL.ASM   6-19-2025  14:26:37         PAGE 28


SYMBOL TABLE
  LABEL                             VALUE 

_WDT_OFF                          00003FF7
_WDT_ON                           00003FFF
_WRT_1FOURTH                      00003BFF
_WRT_256                          00003DFF
_WRT_HALF                         000039FF
_WRT_OFF                          00003FFF
_XT_OSC                           00003FF9
__16F887                          00000001

Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :    16 reported,     0 suppressed

